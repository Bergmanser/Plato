<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="./assets/images/MeerDanBijles-Logo.png">
    <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"></script>
    <title>Quiz Overlay Prototype</title>
    <style>
        .quiz-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .quiz-modal {
            background: transparent;
            padding: 45px;
            text-align: center;
            width: 900px;
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: fadeIn 0.5s;
        }

        .score-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 45px;
        }

        .score-circle {
            width: 337.5px;
            height: 337.5px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 81px;
            font-weight: bold;
            position: relative;
            margin: 0 100px; /* Increased margin */
            color: white;
        }

        .score-circle span {
            z-index: 3;
        }

        .score-circle .black-ring {
            position: absolute;
            width: 328.5px;
            height: 328.5px;
            border-radius: 50%;
            border: 15.75px solid black;
            box-sizing: border-box;
            z-index: 1;
        }

        .score-circle .colored-ring {
            position: absolute;
            width: 319.5px;
            height: 319.5px;
            border-radius: 50%;
            border: 9px solid transparent;
            box-sizing: border-box;
            z-index: 2;
        }

        .divider-vertical {
            width: 2.25px;
            height: 337.5px;
            background: black;
        }

        .timer {
            font-size: 40.5px;
            margin-bottom: 45px;
            color: #ffffff;
        }

        .quiz-close {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 24px;
        }

        .quiz-close:hover {
            background: #0056b3;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .pulsating-glow {
            animation: pulsate 2s infinite; /* Slowed down to 2s */
        }

        @keyframes pulsate {
            0% { box-shadow: 0 0 11.25px gold; }
            50% { box-shadow: 0 0 45px gold; }
            100% { box-shadow: 0 0 11.25px gold; }
        }

        .gold-ring {
            position: relative;
        }

        .gold-ring .olive-crown {
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            width: 500px; 
            height: 400px;
            z-index: 0;
        }

        /* Confetti canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        .score-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: white;
        }

        .score-summary {
            font-size: 28px;
            margin-top: 20px;
            margin-bottom: 30px;
            color: white;
        }

        .score-summary .correct-questions {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="quizOverlay" class="quiz-overlay">
        <div class="quiz-modal">
            <div class="score-container">
                <div id="scoreWithHintsCircle" class="score-circle">
                    <div class="score-title">Score with Hints</div>
                    <div class="black-ring"></div>
                    <div class="colored-ring"></div>
                    <span id="scoreWithHints">8</span>
                </div>
                <div class="divider-vertical"></div>
                <div id="scoreWithoutHintsCircle" class="score-circle">
                    <div class="score-title">Score without Hints</div>
                    <div class="black-ring"></div>
                    <div class="colored-ring"></div>
                    <span id="scoreWithoutHints">10</span>
                </div>
            </div>
            <div id="scoreSummary" class="score-summary">
                <span id="correctQuestions" class="correct-questions">X</span> out of <span id="totalQuestions">Y</span> questions were correctly answered.
            </div>
            <div class="timer">
                <span id="totalTime">3:41</span>
            </div>
            <button class="quiz-close" onclick="closeQuizModal()">Close</button>
        </div>
    </div>
    
    <canvas id="confetti-canvas"></canvas>
      
    <script>
        function closeQuizModal() {
            $('#quizOverlay').hide();
            stopConfetti();
            console.log("Confetti stopped and overlay hidden");
        }

        function showQuizModal(scoreWithHints, scoreWithoutHints, totalTime, correctQuestions, totalQuestions) {
            $('#scoreWithHints').text(scoreWithHints);
            $('#scoreWithoutHints').text(scoreWithoutHints);
            $('#totalTime').text(totalTime);
            $('#correctQuestions').text(correctQuestions);
            $('#totalQuestions').text(totalQuestions);

            // Apply styles based on score values
            setCircleColor('#scoreWithHintsCircle', scoreWithHints);
            setCircleColor('#scoreWithoutHintsCircle', scoreWithoutHints);

            // Set summary color
            setSummaryColor(correctQuestions, totalQuestions);

            $('#quizOverlay').show();
            startConfetti(); // Start confetti when modal is shown
            console.log("Confetti started and overlay displayed");
        }

        function setCircleColor(circleId, score) {
            const circle = $(circleId);
            const coloredRing = circle.find('.colored-ring');
            circle.removeClass('gold-ring pulsating-glow');
            circle.find('.olive-crown').remove();
            coloredRing.css('border-color', 'transparent');

            if (score === 10) {
                circle.addClass('gold-ring pulsating-glow');
                circle.append('<img src="../public/assets/images/olive_crown.png" class="olive-crown" alt="Olive Crown">');
                coloredRing.css('border-color', 'gold');
            } else if (score >= 5.5 && score <= 9.9) {
                coloredRing.css('border-color', 'green');
            } else {
                coloredRing.css('border-color', 'crimson');
            }
        }

        function setSummaryColor(correctQuestions, totalQuestions) {
            const summary = $('#correctQuestions');
            if (correctQuestions >= totalQuestions / 2) {
                summary.css('color', 'green');
            } else {
                summary.css('color', 'crimson');
            }
        }

        // Example usage:
        $(document).ready(function() {
            showQuizModal(8, 10, '3:41', 7, 10);
        });

        // Confetti code
        var maxParticleCount = 150; // set max confetti count
        var particleSpeed = 2; // set the particle animation speed
        var startConfetti; // call to start confetti animation
        var stopConfetti; // call to stop adding confetti
        var toggleConfetti; // call to start or stop the confetti animation depending on whether it's already running
        var removeConfetti; // call to stop the confetti animation and remove all confetti immediately

        (function() {
            startConfetti = startConfettiInner;
            stopConfetti = stopConfettiInner;
            toggleConfetti = toggleConfettiInner;
            removeConfetti = removeConfettiInner;
            var colors = ["DodgerBlue", "OliveDrab", "Gold", "Pink", "SlateBlue", "LightBlue", "Violet", "PaleGreen", "SteelBlue", "SandyBrown", "Chocolate", "Crimson"]
            var streamingConfetti = false;
            var animationTimer = null;
            var particles = [];
            var waveAngle = 0;
            
            function resetParticle(particle, width, height) {
                particle.color = colors[(Math.random() * colors.length) | 0];
                particle.x = Math.random() * width;
                particle.y = Math.random() * height - height;
                particle.diameter = Math.random() * 10 + 5;
                particle.tilt = Math.random() * 10 - 10;
                particle.tiltAngleIncrement = Math.random() * 0.07 + 0.05;
                particle.tiltAngle = 0;
                return particle;
            }

            function startConfettiInner() {
                console.log("Starting confetti animation");
                var width = window.innerWidth;
                var height = window.innerHeight;
                window.requestAnimFrame = (function() {
                    return window.requestAnimationFrame ||
                        window.webkitRequestAnimationFrame ||
                        window.mozRequestAnimationFrame ||
                        window.oRequestAnimationFrame ||
                        window.msRequestAnimationFrame ||
                        function (callback) {
                            return window.setTimeout(callback, 16.6666667);
                        };
                })();
                var canvas = document.getElementById("confetti-canvas");
                if (canvas === null) {
                    canvas = document.createElement("canvas");
                    canvas.setAttribute("id", "confetti-canvas");
                    canvas.setAttribute("style", "display:block;z-index:999999;pointer-events:none");
                    document.body.appendChild(canvas);
                    canvas.width = width;
                    canvas.height = height;
                    window.addEventListener("resize", function() {
                        canvas.width = window.innerWidth;
                        canvas.height = window.innerHeight;
                    }, true);
                }
                var context = canvas.getContext("2d");
                while (particles.length < maxParticleCount)
                    particles.push(resetParticle({}, width, height));
                streamingConfetti = true;
                if (animationTimer === null) {
                    (function runAnimation() {
                        context.clearRect(0, 0, window.innerWidth, window.innerHeight);
                        if (particles.length === 0)
                            animationTimer = null;
                        else {
                            updateParticles();
                            drawParticles(context);
                            animationTimer = requestAnimFrame(runAnimation);
                        }
                    })();
                }
            }

            function stopConfettiInner() {
                console.log("Stopping confetti animation");
                streamingConfetti = false;
            }

            function removeConfettiInner() {
                stopConfetti();
                particles = [];
                console.log("Confetti removed");
            }

            function toggleConfettiInner() {
                if (streamingConfetti)
                    stopConfettiInner();
                else
                    startConfettiInner();
            }

            function drawParticles(context) {
                var particle;
                var x;
                for (var i = 0; i < particles.length; i++) {
                    particle = particles[i];
                    context.beginPath();
                    context.lineWidth = particle.diameter;
                    context.strokeStyle = particle.color;
                    x = particle.x + particle.tilt;
                    context.moveTo(x + particle.diameter / 2, particle.y);
                    context.lineTo(x, particle.y + particle.tilt + particle.diameter / 2);
                    context.stroke();
                }
            }

            function updateParticles() {
                var width = window.innerWidth;
                var height = window.innerHeight;
                var particle;
                waveAngle += 0.01;
                for (var i = 0; i < particles.length; i++) {
                    particle = particles[i];
                    if (!streamingConfetti && particle.y < -15)
                        particle.y = height + 100;
                    else {
                        particle.tiltAngle += particle.tiltAngleIncrement;
                        particle.x += Math.sin(waveAngle);
                        particle.y += (Math.cos(waveAngle) + particle.diameter + particleSpeed) * 0.5;
                        particle.tilt = Math.sin(particle.tiltAngle) * 15;
                    }
                    if (particle.x > width + 20 || particle.x < -20 || particle.y > height) {
                        if (streamingConfetti && particles.length <= maxParticleCount)
                            resetParticle(particle, width, height);
                        else {
                            particles.splice(i, 1);
                            i--;
                        }
                    }
                }
            }
        })();
    </script>
</body>
</html>
